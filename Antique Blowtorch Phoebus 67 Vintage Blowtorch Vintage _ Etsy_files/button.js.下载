(function(){try{var g=this;function k(a,b){var c=l;return!!a||(c.log(b),!1)}function m(a){return a}function n(a,b){for(var c=b.split(".");c.length&&a;)a=a[c.shift()];return a}function p(a,b){if(!Array.isArray(a))return!1;b=b||m;for(var c=0,d=a.length;c<d;c++)if(!0===b(a[c]))return!0;return!1}function q(a,b,c){a=n(a,b);return"string"===typeof a?a:c||""}function r(a,b){var c=n(a,b);return Array.isArray(c)?c:[]}function t(a,b){for(var c=r(a,b),d=[],e=0,h=c.length;e<h;e++)d.push(u(c[e])?c[e]:{});return d}
function u(a){return!(!a||a.constructor!==Object)};function v(a,b){var c=(g.ButtonWebConfig||{})[a];return void 0===c?b:c}function w(a,b){var c=v(a,b);return"string"===typeof c?c:b||""}function x(a,b){var c=v(a,b);return"boolean"===typeof c?c:b||!1}function y(a){a=v(a);if("function"===typeof a)return a};function z(a,b){"function"===typeof a&&a.apply(g,Array.prototype.slice.call(arguments,1))};var A=void 0;function B(){return"try{"+w("siteCatalyst","s")+".tl(true,'e','usebutton')}catch(e){}"}function D(){void 0===A&&(A="function"===typeof n(g,w("siteCatalyst","s")+".tl"));return A};function E(a,b){for(var c in b){var d=b[c];"[object Object]"===Object.prototype.toString.call(d)?E(a[c],d):a[c]=d}}function F(a,b){var c=document.createElement(a),d=Array.prototype.splice.call(arguments,1);"a"===a&&(c.rel="noskim",c.setAttribute("data-bttnio-link",1),D()&&c.setAttribute("onclick",B()));for(var e=0,h=d.length;e<h;e++)for(var f in d[e])d[e].hasOwnProperty(f)&&(c.style[f]=d[e][f]);return c}
function G(a){var b,c=F("a");E(c,a);b=b||[];a=0;for(var d=b.length;a<d;++a)c.appendChild(b[a]);return c};var H=/^(?:track\.bttn\.io\/([^\/]+).*|(?!track)([^\.]+)\.bttn\.io(?:\/.*|$))/,I=F("a");function J(a){return a.replace(/^www./,"").toLowerCase()}function K(){var a={},b=I.search.replace(/^\?/,"").split("&"),c,d,e;c=0;for(d=b.length;c<d;c++)e=b[c].split("="),a[e[0]]=decodeURIComponent(e[1]||"");return a}
function L(a){var b=a.dataset.bttnioTargetHref;if(void 0!==b)return b;var b=v("relativeLinkLocation"),b=u(b)?b:null,c=document.createElement("a");c.href="/";b=null===b||c.hostname!==a.hostname?{hostname:a.hostname,port:a.port}:{hostname:q(b,"hostname",a.hostname),port:q(b,"port",a.port)};I.href=a.href;I.hostname=b.hostname;b.port&&(I.port=b.port);return I.href}
function M(a,b){var c=b.links_configuration,d=L(a);I.href=d;var e=J(I.hostname),h=I.pathname,f=K();if(!c||a.getAttribute("data-bttnio-enhanced")||a.getAttribute("data-bttnio-link"))return!1;var O=t(c,"supported_hostnames");if(p(O,function(a){return e===J(q(a,"hostname"))}))return!0;d=t(c,"supported_bttnio_subdomains");if(d.length){var C=(e+h).match(H);if(C){var Z=C[1]||C[2];if(p(d,function(a){return Z.toLowerCase()===q(a,"subdomain")}))return!0}}c=t(c,"supported_affiliates");return p(c,function(a){if(e!==
J(q(a,"hostname")))return!1;var b=t(a,"query_url_keys"),b=p(b,function(a){a=q(a,"key");if(f.hasOwnProperty(a)){var b=J(G({href:f[a]}).hostname);return p(O,function(a){return b===J(q(a,"hostname"))})}return!1}),c=t(a,"query_ids"),c=p(c,function(a){var b=q(a,"key");return f.hasOwnProperty(b)?(a=t(a,"values"),p(a,function(a){return q(a,"value")===f[b]})):!1});a=t(a,"pathname_ids");a=p(a,function(a){var b=q(a,"regex"),c;if(!b)return!1;try{c=(new RegExp(b)).exec(h)}catch(d){return!1}if(c){var e=c.slice(1);
a=t(a,"matches");return p(a,function(a){a:if(a=r(a,"values"),Array.isArray(e)&&Array.isArray(a)&&e.length===a.length){var b,c;b=0;for(c=e.length;b<c;b++)if(e[b]!==a[b]){a=!1;break a}a=!0}else a=!1;return a})}return!1});return b||c||a})};function aa(a){try{return g.JSON.stringify(a)}catch(b){return"{}"}};function N(a){var b=g.XMLHttpRequest,c=P;this.a=a;this.c=b;this.b=c}
function Q(a,b,c,d,e,h){var f=new a.c;f.onreadystatechange=function(){if(4===f.readyState&&"function"===typeof h){var b=f.responseText,c=a.b,d;try{(d=g.JSON.parse(b))&&d.constructor===Object||(d={})}catch(e){c.log("Invalid JSON:"+b),d={}}h(d)}};f.open(b,a.a+c);if(Array.isArray(e))for(b=0;b<e.length;b++)f.setRequestHeader(e[b].l,e[b].value);f.setRequestHeader("X-BTNVersion","2.0.0");d&&f.setRequestHeader("Content-Type","application/json");f.send(d?aa(d):void 0)}
function ba(a,b,c){Q(a,"GET",b,null,null,c)}function R(a,b,c,d,e){Q(a,"POST",b,c,d,e)};function S(a){a+="=";var b=document.cookie.split(";"),c,d;for(c=0;c<b.length;c++){for(d=b[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}}function T(a,b,c,d){a=[a+"="+b,"path=/","max-age="+(void 0===c?31536E3:c)];d&&"string"===typeof d&&0<d.trim().length&&a.push("domain=."+d);document.cookie=a.join(";")};function ca(){var a={},b=(n(g.location,"search")||"").replace(/^\?/,"").split("&"),c,d,e;c=0;for(d=b.length;c<d;c++)e=b[c].split("="),2===e.length&&(a[e[0]]=e[1]);(a=a.btn_ref)&&T("bttnreferrertoken",a,void 0,w("referrerCookieDomain"))};var da=/^sess-/;function ea(a,b,c){var d=[],e=v("userIdentifier"),h,f;h=0;for(f=b.length;h<f;h++)d.push({pub_ref:b[h].dataset.bttnioPubRef,href:L(b[h])});a={application_id:a,links:d};c&&(a.session_id=c);e&&(a.thirdparty_id=e);return a}
function U(a,b,c){var d=S("bttnsessionid");this.c=da.test(d)?d:void 0;this.f=b;this.m=c;this.a=a;this.c&&this.a.log("Restored sessionId: "+this.c);this.i=!!S("bttnlockout");this.h=!1;this.g=null;this.b=[];this.j=!1;ca();if(this.i)this.a.log("bttnlockout cookie found: platform is not supported");else{if(v("enhanceLinks")){var e=this;fa(e,function(a){e.g=a;e.refresh()})}(a=v("siteCatalyst"))&&"function"!==typeof g[a].tl&&this.a.log("Invalidate SiteCatalyst detected: "+a+".tl is not a function")}}
function fa(a,b){var c=v("applicationId");c?a.h||(a.h=!0,ba(a.f,"/v1/web-session/config?application_id="+c,function(c){a.h=!1;z(b,n(c,"object")||null)})):a.a.log("Missing ButtonWebConfig.application_id")}function ga(a){if(!a.g)return[];var b=[].slice.call(document.querySelectorAll(w("linkSelector","a"))),c=[],d,e;d=0;for(e=b.length;d<e;d++)M(b[d],a.g)&&c.push(b[d]);return c.slice(0,50)}
U.prototype.refresh=function(a){var b=this,c=w("applicationId");b.i?b.a.log("Unsupported platform; will not make requests"):c?(b.b=ga(b),1>b.b.length||(c=ea(c,b.b,b.c),R(b.f,"/v1/web-session/get-buttons",c,null,function(c){if("error"in c)b.a.log("Error enhancing links: "+n(c,"error.message")),z(a,!1,[]);else{var e=n(c,"object.supported_os");b.j||(b.j=!0,z(y("onLoad"),e));if(e){var e=n(c,"object.links")||[],h=e.length,f=q(c,"object.session_id");c=[];b.c&&f===b.c||b.a.log("Initiating new session: "+
f);b.c=f;T("bttnsessionid",f);if(h===b.b.length)for(f=0;f<h;f++)e[f]&&(b.b[f].href=e[f],b.b[f].setAttribute("rel","noskim"),b.b[f].setAttribute("data-bttnio-enhanced",1),D()&&b.b[f].setAttribute("onclick",B()));z(y("onButtonsLoaded"),c);z(a,!0,c)}else b.a.log("Received unsupported platform signal. Will set bttnlockout cookie"),T("bttnlockout","1",14400)}}))):b.a.log("Error: No applicationId present in ButtonWebConfig!")};U.prototype.logout=function(){T("bttnsessionid","",0)};
function ha(a,b,c){R(a.f,"/v1/web-session/events",{session_id:a.c,events:b},null,function(a){"function"===typeof c&&c("ok"===n(a,"meta.status"))})}U.prototype.reportEvent=function(a,b,c){this.c?this.i?this.a.log("Platform not supported, will not report events"):(a={name:a},u(b)&&(a.value=b),ha(this,[a],c)):this.a.log("No Button session \u2013 cannot report events")};U.prototype.getReferrerToken=function(){return S("bttnreferrertoken")};
U.prototype.reportOrder=function(a,b){if(u(a)){var c=w("applicationId");if(c){var c=g.btoa(c+":"),d=S("bttnreferrertoken"),e=x("reportAllOrders");d||e?(d&&(a.btn_ref=d),R(this.m,"/v1/mobile-order",a,[{l:"Authorization",value:"Basic "+c}],function(a){"function"===typeof b&&b(a)})):this.a.log("Missing btn_ref")}else this.a.log("Missing ButtonWebConfig.application_id")}else this.a.log("Invalid order, cannot post")};function V(a){this.a=a}V.prototype.log=function(a){this.a&&g.console&&g.console.log("[Button]",a)};var W=g.__bttnio||"bttnio",P=new V(x("enableLogging",!1));
if(n(g,W+".ok"))P.log("The ButtonJS snippet was loaded multiple times");else{var X=n(g,W+".q")||[],ia=new N("https://web.usebutton.com"),ja=new N("https://api.usebutton.com"),l=P,Y=k(g.XMLHttpRequest,"No XMLHttpRequest")&&k(g.JSON,"No native JSON support")?new U(P,ia,ja):{};g[W]=function(){var a=[].slice.call(arguments),b=a.shift();if(b&&"function"===typeof Y[b])return P.log(b+"("+a.join(",")+")"),Y[b].apply(Y,a)};for(g[W].ok=!0;X.length;)g[W].apply(this,X.shift())};}catch(e){}})();
